(()=>{"use strict";var e=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),t=document.querySelector(".places__list");function n(t,n,o,r,c,i,a,u){var l=e.cloneNode(!0);l.querySelector(".card__title").textContent=t;var s=l.querySelector(".card__image");s.src=n,s.alt="Изображение места: ".concat(t),s.addEventListener("click",(function(){return i(t,n)}));var d=l.querySelector(".card__delete-button");return a!==u?d.remove():d.addEventListener("click",(function(){return r(l)})),l.querySelector(".card__like-button").addEventListener("click",(function(){return c(l)})),l.querySelector(".card__like-number").textContent=o.length,o.forEach((function(e){e._id===a&&l.querySelector(".card__like-button").classList.add("card__like-button_is-active")})),l}function o(e){e.querySelector(".card__like-button").classList.contains("card__like-button_is-active"),e.querySelector(".card__like-button").classList.toggle("card__like-button_is-active")}function r(e){e.classList.add("popup_is-opened"),e.addEventListener("click",a),document.addEventListener("keydown",c)}function c(e){if("Escape"===e.key){var t=document.querySelector(".popup_is-opened");t&&u(t)}}function i(){var e=document.querySelector(".popup_is-opened");e&&u(e)}function a(e){var t=document.querySelector(".popup_is-opened");t.querySelector(".popup__content").contains(e.target)||t&&u(t)}function u(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c),e.removeEventListener("click",a)}function l(e){e.reset()}function s(e,t,n){e.classList.remove(n.inputErrorClass);var o=t.querySelector(".".concat(e.id,"-error"));o.classList.remove(n.errorClass),o.textContent=""}function d(e,t,n){e.every((function(e){return e.validity.valid}))?(t.classList.remove(n.inactiveButtonClass),t.disabled=!1):(t.classList.add(n.inactiveButtonClass),t.disabled=!0)}function p(e,t){var n=e.querySelectorAll(t.inputSelector),o=e.querySelector(t.submitButtonSelector);n.forEach((function(n){s(n,e,t)})),o.classList.add(t.inactiveButtonClass),o.disabled=!0}var f="https://mesto.nomoreparties.co/v1/wff-cohort-36",_="32bfec9d-5953-4d12-afbb-e7f5f60e8235";function y(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}function m(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,o=Array(t);n<t;n++)o[n]=e[n];return o}var v=document.querySelector(".popup__form[name=new-place]"),h=v.querySelector(".popup__input_type_card-name"),S=v.querySelector(".popup__input_type_url"),b=document.querySelector(".profile__title"),q=document.querySelector(".profile__description"),C=document.querySelector(".profile__image"),k="";function E(e,t){(function(e){return fetch("".concat(f,"/cards/").concat(e),{method:"DELETE",headers:{authorization:_}}).then(y)})(t).then((function(){e.remove()})).catch((function(e){console.log(e)}))}function g(e,t){var n,r=e.querySelector(".card__like-button"),c=e.querySelector(".card__like-number");r.classList.contains("card__like-button_is-active")?(n=t._id,fetch("".concat(f,"/cards/likes/").concat(n),{method:"DELETE",headers:{authorization:_}}).then(y)).then((function(t){c.textContent=t.likes.length,o(e)})).catch((function(e){console.log(e)})):function(e){return fetch("".concat(f,"/cards/likes/").concat(e),{method:"PUT",headers:{authorization:_}}).then(y)}(t._id).then((function(t){c.textContent=t.likes.length,o(e)})).catch((function(e){console.log(e)}))}Promise.all([fetch("".concat(f,"/users/me"),{headers:{authorization:_}}).then(y),fetch("".concat(f,"/cards"),{headers:{authorization:_}}).then(y)]).then((function(e){var o,r,c=(r=2,function(e){if(Array.isArray(e))return e}(o=e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var o,r,c,i,a=[],u=!0,l=!1;try{if(c=(n=n.call(e)).next,0===t){if(Object(n)!==n)return;u=!1}else for(;!(u=(o=c.call(n)).done)&&(a.push(o.value),a.length!==t);u=!0);}catch(e){l=!0,r=e}finally{try{if(!u&&null!=n.return&&(i=n.return(),Object(i)!==i))return}finally{if(l)throw r}}return a}}(o,r)||function(e,t){if(e){if("string"==typeof e)return m(e,t);var n={}.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(e):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?m(e,t):void 0}}(o,r)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()),i=c[0],a=c[1];b.textContent=i.name,q.textContent=i.about,C.style.backgroundImage="url(".concat(i.avatar,")"),k=i._id,a.reverse(),a.forEach((function(e){t.prepend(n(e.name,e.link,e.likes,(function(t){return E(t,e._id)}),(function(t){return g(t,e)}),w,k,e.owner._id))}))})).catch((function(e){console.log(e)})),document.querySelectorAll(".popup__close").forEach((function(e){e.addEventListener("click",i)}));var L=document.querySelector(".popup_type_image"),x=L.querySelector(".popup__image"),A=L.querySelector(".popup__caption");function w(e,t){r(L),x.src=t,x.alt=e,A.textContent=e}var T=document.querySelector(".popup_type_edit"),j=document.querySelector(".popup_type_new-card"),z=document.querySelector('.popup__form[name="edit-profile"]'),B=z.querySelector(".popup__input_type_name"),O=z.querySelector(".popup__input_type_description"),P=document.querySelector(".popup_type_avatar"),D=document.querySelector('.popup__form[name="edit-avatar"]');C.addEventListener("click",(function(){p(D,M),l(D),r(P)})),z.addEventListener("submit",(function(e){e.preventDefault();var t=B.value,n=O.value;e.submitter.textContent="Сохранение...",function(e,t){return fetch("".concat(f,"/users/me"),{method:"PATCH",headers:{authorization:_,"Content-Type":"application/json"},body:JSON.stringify({name:e,about:t})}).then(y)}(t,n).then((function(e){b.textContent=e.name,q.textContent=e.about,u(T),z.reset()})).catch((function(e){console.log(e)})).finally((function(){e.submitter.textContent="Сохранить"}))})),v.addEventListener("submit",(function(e){e.preventDefault();var o,r,c=v.querySelector(".popup__button");c.textContent="Сохранение...",(o=h.value,r=S.value,fetch("".concat(f,"/cards"),{method:"POST",headers:{authorization:_,"Content-Type":"application/json"},body:JSON.stringify({name:o,link:r})}).then(y)).then((function(e){t.prepend(n(e.name,e.link,e.likes,(function(t){return E(t,e._id)}),(function(t){return g(t,e)}),w,k,e.owner._id)),u(j),v.reset()})).catch((function(e){console.log(e)})).finally((function(){c.textContent="Сохранить"}))})),D.addEventListener("submit",(function(e){e.preventDefault();var t=D.querySelector(".popup__button");t.textContent="Сохранение...";var n,o=document.querySelector(".popup__input_type_avatar").value;(n=o,fetch("".concat(f,"/users/me/avatar"),{method:"PATCH",headers:{authorization:_,"Content-Type":"application/json"},body:JSON.stringify({avatar:n})}).then(y)).then((function(){C.style.backgroundImage="url(".concat(o,")"),D.reset(),u(P)})).catch((function(e){console.log(e)})).finally((function(){t.textContent="Сохранить"}))}));var I=document.querySelector(".profile__edit-button"),N=document.querySelector(".profile__add-button");I.addEventListener("click",(function(){p(z,M),r(T),B.value=b.textContent,O.value=q.textContent})),N.addEventListener("click",(function(){p(v,M),l(v),r(j)}));var J,M={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_is_invalid",errorClass:"form__error_is_visible"};J=M,Array.from(document.querySelectorAll(J.formSelector)).forEach((function(e){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){e.validity.patternMismatch?e.setCustomValidity(e.dataset.error):e.setCustomValidity(""),e.validity.valid?s(e,t,n):function(e,t,n){e.classList.add(n.inputErrorClass);var o=t.querySelector(".".concat(e.id,"-error"));o.classList.add(n.errorClass),o.textContent=e.validationMessage}(e,t,n)}(r,e,t),d(n,o,t)}))})),d(n,o,t)}(e,J)}))})();